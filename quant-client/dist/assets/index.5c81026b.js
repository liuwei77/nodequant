var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;import{r as a,R as l,a as c,C as i,b as s,L as m,T as u,I as d,B as p,E,D as f,M as v,i as b,c as N,d as w,e as y}from"./vendor.6b51fa12.js";function g(){const[e,t]=a.exports.useState({increase:[],decrease:[],volume:[]});return a.exports.useEffect((()=>{const e=window.setInterval((()=>{const e=JSON.parse(localStorage.topFive);e&&t(e)}),5e3);return()=>clearInterval(e)}),[]),l.createElement("div",null,l.createElement(c,{gutter:16},l.createElement(i,{span:8},l.createElement(s,{title:"涨幅前五",bordered:!1},l.createElement(m,{dataSource:e.increase,renderItem:e=>{var t,r;return l.createElement(m.Item,null,e.symbol,l.createElement(u,{color:"#f50"},Math.floor(100*(null!=(r=null==(t=e.ticket)?void 0:t.increase)?r:0))+"%"))}}))),l.createElement(i,{span:8},l.createElement(s,{title:"跌幅前五",bordered:!1},l.createElement(m,{dataSource:e.decrease,renderItem:e=>{var t,r;return l.createElement(m.Item,null,e.symbol,l.createElement(u,{color:"#87d068"},Math.floor(100*(null!=(r=null==(t=e.ticket)?void 0:t.decrease)?r:0))+"%"))}}))),l.createElement(i,{span:8},l.createElement(s,{title:"交易量前五",bordered:!1},l.createElement(m,{dataSource:e.volume,renderItem:e=>{var t;return l.createElement(m.Item,null,e.symbol,l.createElement(u,{color:"blue"},null==(t=e.ticket)?void 0:t.volume))}})))))}var S,h;(h=S||(S={})).NORMAL="normal",h.EDITTING="editting";const k={hour:9,minute:30},P={hour:21,minute:0};const I=()=>{let e,t,r,n,o=.02,a=!1,l=!1;return{SAR:c=>{if(!(()=>{const e=new Date,t=e.getHours(),r=e.getTime(),n=new Date(e.toDateString()).getTime(),o=t<12?k:P;return r-n-1e3*(3600*o.hour+60*o.minute)>9e5})())return-1;let i;var s;return void 0===r&&(r=(e=>e.closePrice>1.03*e.preClosePrice)(c)),void 0===n&&(n=(e=>e.closePrice<.97*e.preClosePrice)(c)),t||(t=c),e?((r&&c.highPrice>t.highPrice||!r&&c.lowPrice<t.lowPrice)&&(o=Math.min(.2,o+.02)),i=e+o*((r?t.highPrice:t.lowPrice)-e),i=r?Math.min(i,c.lowPrice,t.lowPrice):Math.max(i,c.highPrice,t.highPrice)):e=i=r?c.lowPrice:c.highPrice,a=t.closePrice<=e&&c.closePrice>i,l=t.closePrice>=e&&c.closePrice<i,a&&console.log("isUpCross",c,a),a&&(s="发生SAR穿越，买入价格"+i,"Notification"in window?"granted"===Notification.permission?(new Notification(s,{silent:!1}),document.querySelector("#audio").play()):"denied"!==Notification.permission&&Notification.requestPermission((function(e){"permission"in Notification||(Notification.permission=e),"granted"===e&&new Notification(s)})):alert("你的不支持 Notification!  TAT")),t=c,e=i,i},isUpCross:()=>a,isDownCross:()=>l}},T=[];function C(){const[e,c]=a.exports.useState(T),[i,s]=a.exports.useState(!1),[b,N]=a.exports.useState(""),w={id:"",symbol:"",price:0,status:S.NORMAL},y=()=>{s(!1)},g=t=>{v.confirm({title:"确认",content:"确认删除此合约吗？",okText:"确定",cancelText:"取消",onOk:()=>(t=>{const r=e.findIndex((e=>e.symbol===t.symbol));r>=0&&(e.splice(r,1),c(e.concat([])),window.socket.emit("unsubscribe",b))})(t)})};return a.exports.useEffect((()=>{const t=window.setInterval((()=>{const t=localStorage.contracts?JSON.parse(localStorage.contracts).contracts:[];e.length>0?(t.forEach((t=>{const r=e.find((e=>e.symbol===t.symbol));r&&(r.ticket=t.ticket,r.ticket&&(!r.sarTools&&(r.sarTools=I()),r.sar=r.sarTools.SAR(r.ticket)))})),c(e.concat([]))):c(t)}),5e3);return()=>{clearInterval(t)}})),l.createElement("div",null,l.createElement(m,{className:"contracts",itemLayout:"horizontal",dataSource:e,renderItem:t=>{var r,n,o,a,i,s,v,b,N;return l.createElement(m.Item,{key:t.symbol,title:t.symbol,className:null!=(r=t.status)?r:"normal"},l.createElement("div",{className:"name"},l.createElement("b",null,t.symbol),l.createElement(d,{value:t.symbol,className:"input",onChange:r=>((t,r)=>{var n;t.symbol=null!=(n=r.value)?n:"",c(e.concat([]))})(t,r.target),addonAfter:l.createElement(p,{onClick:()=>(t=>{c(e.concat([])),t.status=S.NORMAL,window.socket.emit("resubscribe",e.map((e=>e.symbol)))})(t),type:"text",size:"small"},"确定")}),l.createElement("span",{className:"extra"},l.createElement(E,{onClick:()=>(t.status=S.EDITTING,void c(e.concat([])))}),l.createElement(f,{style:{color:"#ff4d4f"},onClick:()=>g(t)}))),l.createElement("div",null,l.createElement("span",{className:"price"},"收盘价：",l.createElement(u,{color:"#2db7f5"},(null==(n=t.ticket)?void 0:n.closePrice)||0)),l.createElement("span",{className:"price"},"开盘价：",l.createElement(u,{color:"#2db7f5"},(null==(o=t.ticket)?void 0:o.openPrice)||0))),l.createElement("div",null,l.createElement("span",{className:"price"},"最高价：",l.createElement(u,{color:"#f50"},(null==(a=t.ticket)?void 0:a.highPrice)||0)),l.createElement("span",{className:"price"},"最低价：",l.createElement(u,{color:"#87d068"},(null==(i=t.ticket)?void 0:i.lowPrice)||0))),l.createElement("div",null,l.createElement("span",{className:"price"},"SAR：",l.createElement(u,{color:"#108009"},t.sar||"")),l.createElement("span",{className:"price"},"SAR向上穿越：",l.createElement(u,{color:"default"},(null==(s=t.sarTools)?void 0:s.isUpCross)&&(null==(v=t.sarTools)?void 0:v.isUpCross())?"发生":"未发生")),l.createElement("span",{className:"price"},"SAR向下穿越：",l.createElement(u,{color:"default"},(null==(b=t.sarTools)?void 0:b.isDownCross)&&(null==(N=t.sarTools)?void 0:N.isDownCross())?"发生":"未发生"))))}}),l.createElement("p",null,l.createElement(p,{type:"primary",onClick:()=>{s(!0)}},"增加")),l.createElement(v,{cancelText:"取消",okText:"增加",title:"增加合约",visible:i,onCancel:y,onOk:()=>{w.symbol=b,w.id=(new Date).getTime().toString(),e.push(((e,a)=>{for(var l in a||(a={}))r.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&o(e,l,a[l]);return e})({},w)),c(e.concat([])),w.symbol="",w.id="",N(""),y(),window.socket.emit("subscribe",b)}},l.createElement("p",null,l.createElement(d,{value:b,addonBefore:"合约代码",onChange:e=>{return t=e.target,void N(t.value);var t}}))))}const{Sider:x,Content:O}=N,A=b("http://192.168.1.19:3000");function D(){const[e,t]=a.exports.useState("view");return l.createElement(N,{className:"app"},l.createElement(x,null,l.createElement(w,{theme:"dark",mode:"vertical",defaultSelectedKeys:["view"],onClick:e=>{return r=e.key,t(r);var r}},l.createElement(w.Item,{key:"view"},"市场信息"),l.createElement(w.Item,{key:"edit"},"订阅合约"))),l.createElement(O,{className:"content"},"view"===e?l.createElement(g,null):l.createElement(C,null)))}window.socket=A,A.on("subscribeContracts",(e=>{localStorage.contracts=JSON.stringify(e)})),A.on("market",(e=>{localStorage.setItem("topFive",JSON.stringify(e))})),A.on("error",(()=>{A.close(),A.connect()})),A.on("test",(()=>{var e;"Notification"in window?"granted"===Notification.permission?(new Notification("Au111 ",{silent:!1}),null==(e=document.querySelector("#audio"))||e.play()):"denied"!==Notification.permission&&Notification.requestPermission((function(e){"permission"in Notification||(Notification.permission=e),"granted"===e&&new Notification("Au111 ")})):alert("你的不支持 Notification!  TAT")})),y.render(l.createElement(l.StrictMode,null,l.createElement(D,null)),document.getElementById("root"));
